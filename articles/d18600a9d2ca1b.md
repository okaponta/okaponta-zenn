---
title: "Zennå•ç­”ç¬¬Xå›ã€ŒSealed Classã€"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["kotlin", "design", "statemachine"]
published: false
---

# Zennå•ç­”ã¨ã¯

ã€ŒZennå•ç­”ã€ã¨ã¯ã€é–‹ç™ºã—ã¦ã„ã¦ã€Œãªã‚“ã¨ãªãä½¿ã£ã¦ã‚‹ã‘ã©ã€ã¡ã‚ƒã‚“ã¨ç†è§£ã—ã¦ã‚‹ã‹ãªï¼Ÿã€ã¨ã„ã†æŠ€è¡“ã«ã¤ã„ã¦ã€æ”¹ã‚ã¦æ™‚é–“ã‚’ã¨ã£ã¦æ·±æ˜ã‚Šã—ã¦ã¿ã‚ˆã†ã¨ã„ã†ä¼ç”»ã§ã™ğŸ§˜ğŸ§˜ğŸ§˜

# ã¯ã˜ã‚ã«

Kotlinã§é–‹ç™ºã—ã¦ã„ã¦ã€ã€ŒçŠ¶æ…‹ç®¡ç†ã«ã¯sealed classãŒã„ã„ãã€ã¨ã„ã†ã®ã‚’èã„ã¦ã€å®Ÿéš›ã«èª¬æ˜ã‚’èã„ã¦ç†è§£ã—ãŸã‚ˆã†ãªæ°—ã«ãªã£ã¦ã„ã¾ã™ãŒã€è‡ªåˆ†ã§å®Ÿè£…ã—ã¦ã¨è¨€ã‚ã‚Œã‚‹ã¨ã±ã£ã¨è¨€ãˆãªã„ç¨‹åº¦ã®ç†è§£åº¦ã§ã™ã€‚

ãªã®ã§ã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§sealed classã‚’ä½¿ã†ã“ã¨ã§ã©ã†ã„ã†åˆ¶ç´„ã‚’ã©ã†å®Ÿç¾ã§ãã‚‹ã®ã‹ã‚’æ·±æ˜ã‚Šã—ãŸã„ã¨æ€ã„ã€é¸å®šã—ã¾ã—ãŸã€‚

## Sealed Classã¨ã¯ä½•ãªã®ã‹ï¼Ÿ

Sealed Classã¯ã€**åˆ¶é™ã•ã‚ŒãŸç¶™æ‰¿éšå±¤**ã‚’ä½œæˆã§ãã‚‹Kotlinã®æ©Ÿèƒ½ã§ã™ã€‚ã™ã¹ã¦ã®ç›´æ¥ã‚µãƒ–ã‚¯ãƒ©ã‚¹ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ—¢çŸ¥ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦`when`å¼ã§ã®**ç¶²ç¾…çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°**ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```kotlin
sealed class NetworkState {
    object Idle : NetworkState()
    object Loading : NetworkState()
    data class Success(val data: String) : NetworkState()
    data class Error(val exception: Throwable) : NetworkState()
}

// whenå¼ã§å…¨ã¦ã®ã‚±ãƒ¼ã‚¹ã‚’å¼·åˆ¶çš„ã«ã‚«ãƒãƒ¼
fun handleNetworkState(state: NetworkState) = when (state) {
    NetworkState.Idle -> showInitialScreen()
    NetworkState.Loading -> showProgressBar()
    is NetworkState.Success -> displayData(state.data)
    is NetworkState.Error -> showErrorMessage(state.exception.message)
    // elseå¥ãŒä¸è¦ï¼ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå…¨ã‚±ãƒ¼ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
}
```

ä½•ã‹æ¥­å‹™çš„ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ã™ã¨ãã«Intã¨ã‹ã‚ˆã‚Šã‚‚EnumãŒå¥½ã¾ã‚Œã‚‹ç†ç”±ã®ã²ã¨ã¤ã«ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ç¶²ç¾…ã§ãã‚‹ç‚¹ãŒã‚ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚åŒã˜ã‚ˆã†ãªè©±ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¬ãƒ™ãƒ«ã§ã“ã“ã‚’æ‹…ä¿ã—ã¦ãã‚Œã‚‹ã®ã¯ä»•çµ„ã¿ã¨ã—ã¦ç¢ºã‹ã«å¼·åŠ›ã§ã™ã€‚

## çŠ¶æ…‹é·ç§»ã‚’å¼·åˆ¶ã™ã‚‹ä»•çµ„ã¿

Sealed Classã‚’ä½¿ã†ã“ã¨ã§ã€**ä¸æ­£ãªçŠ¶æ…‹é·ç§»ã‚’é˜²ã**ã“ã¨ãŒã§ãã¾ã™ã€‚å¾“æ¥ã®enum classã¨æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### Enum Classã®é™ç•Œ

```kotlin
enum class ReviewState {
    DRAFT, SUBMITTED, UNDER_REVIEW, APPROVED, REJECTED
}

class ReviewStateMachine {
    var currentState = ReviewState.DRAFT
    
    fun submit() {
        // ä¸æ­£ãªçŠ¶æ…‹ã‹ã‚‰ã®é·ç§»ã‚’é˜²ã’ãªã„
        currentState = ReviewState.SUBMITTED
        // APPROVEDçŠ¶æ…‹ã‹ã‚‰SUBMITTEDã«é·ç§»ã§ãã¦ã—ã¾ã†å•é¡Œ
    }
    
    fun approve() {
        // DRAFTçŠ¶æ…‹ã‹ã‚‰ç›´æ¥APPROVEDã«ã§ãã¦ã—ã¾ã†
        currentState = ReviewState.APPROVED
    }
}
```

### Sealed Classã«ã‚ˆã‚‹è§£æ±º

```kotlin
sealed class ReviewState {
    object Draft : ReviewState()
    data class Submitted(val submittedAt: Long) : ReviewState()
    data class UnderReview(val reviewerId: String) : ReviewState()
    data class Approved(val approvedBy: String, val approvedAt: Long) : ReviewState()
    data class Rejected(val rejectedBy: String, val reason: String) : ReviewState()
}

class Paper(
    val id: String,
    val title: String,
    val author: String,
) {
    private var _reviewState: ReviewState = ReviewState.Draft

    fun submit() {
        _reviewState = when (_reviewState) {
            ReviewState.Draft -> {
                ReviewState.Submitted(System.currentTimeMillis())
            }

            is ReviewState.Rejected -> {
                ReviewState.Submitted(System.currentTimeMillis())
            }
            // æ—¢ã«æå‡ºæ¸ˆã¿ã€å¯©æŸ»ä¸­ã€æ‰¿èªæ¸ˆã¿ã®å ´åˆã¯ä¾‹å¤–
            is ReviewState.Submitted,
            is ReviewState.UnderReview -> throw Exception("Already submitted or under review")

            is ReviewState.Approved -> throw Exception("Cannot resubmit - already approved")
        }
    }

    fun startReview(reviewerId: String) {
        when (_reviewState) {
            is ReviewState.Submitted -> {
                _reviewState = ReviewState.UnderReview(reviewerId)
            }
            // Submittedä»¥å¤–ã‹ã‚‰ã¯ä¾‹å¤–
            else -> throw Exception("Cannot start review - not submitted yet")
        }
    }

    fun approve(approvedBy: String) {
        when (_reviewState) {
            is ReviewState.UnderReview -> {
                _reviewState = ReviewState.Approved(approvedBy, System.currentTimeMillis())
            }
            else -> throw Exception("Cannot approve - not under review")
        }
    }

    fun reject(rejectedBy: String, reason: String) {
        when (_reviewState) {
            is ReviewState.UnderReview -> {
                _reviewState = ReviewState.Rejected(rejectedBy, reason)
            }
            else -> throw Exception("Cannot reject - not under review")
        }
    }
}
```

### çŠ¶æ…‹é·ç§»å›³

ã“ã®Paperã‚¯ãƒ©ã‚¹ã®çŠ¶æ…‹é·ç§»ã‚’Mermaidã§è¦–è¦šåŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```mermaid
stateDiagram-v2
    [*] --> Draft
    Draft --> Submitted : submit()
    Submitted --> UnderReview : startReview(reviewerId)
    UnderReview --> Approved : approve(approvedBy)
    UnderReview --> Rejected : reject(rejectedBy, reason)
    Rejected --> Submitted : submit()
```

å®Ÿéš›ã«toString()ã‚‚é©å½“ã«Overrideã—ã¦ã‹ã‚‰ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```kotlin
fun main() {
    val paper = Paper("id","title","author")
    println(paper)
    paper.submit()
    println(paper)
    paper.approve("hoge")
}
```

å®Ÿè¡Œçµæœ
```
Paper(id='id', title='title', author='author', state=Draft)
Paper(id='id', title='title', author='author', state=Submitted at 2025-07-21 15:40)
Exception in thread "main" java.lang.Exception: Cannot approve - not under review
	at org.example.Paper.approve(Main.kt:60)
	at org.example.MainKt.main(Main.kt:8)
	at org.example.MainKt.main(Main.kt)
```

ä¸æ­£ãªçŠ¶æ…‹å¤‰åŒ–ã‚’ã—ã‚ˆã†ã¨ã—ãŸã¨ã“ã‚ã§ExceptionãŒæƒ³å®šé€šã‚Šã«å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ã¾ã¨ã‚

Sealed ClassãŒã€Kotlinã«ãŠã‘ã‚‹çŠ¶æ…‹ç®¡ç†ã§**å¼·åŠ›ãªæ­¦å™¨**ã«ãªã‚‹ã¨ã„ã†ã“ã‚ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚ç‰¹ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ã§ç¶²ç¾…æ€§ã‚’æ‹…ä¿ã§ãã‚‹éƒ¨åˆ†ãŒå¼·åŠ›ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

ã‚ã‚ã›ã¦ã€å‹ã®é·ç§»ã®åˆ¶é™ã‚’ã‹ã‘ã‚‹ã“ã¨ã§ã•ã‚‰ã«å¼·åŠ›ã«é·ç§»ãŒè¡¨ç¾ã§ãã‚‹ã®ã§ã€ç©æ¥µçš„ã«ä½¿ã£ã¦ã„ãã¨ã‚ˆã•ãã†ã ã¨æ”¹ã‚ã¦æ€ã„ã¾ã—ãŸã€‚ãªã‚“ã‹ã€å®Ÿéš›ã«è‡ªåˆ†ã§å®Ÿè£…ã™ã‚‹å‰ã¯ã¡ã‚‡ã£ã¨ã¨ã£ã¤ãã«ãã•ã‚’æ„Ÿã˜ã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã«å®Ÿè£…ã—ã¦ã¿ã‚‹ã¨æ¡ˆå¤–ç›´æ„Ÿçš„ã§ã—ãŸã€‚ä¸€åº¦æ‰‹ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ç†è§£ã‚‚é€²ã¿ãã†ã§ã™ã€‚

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸğŸ™
